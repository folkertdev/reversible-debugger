\documentclass[12pt]{beamer}


\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{fancyvrb}
\usepackage{transparent}
\usepackage{stmaryrd}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
% use upquote if available, for straight quotes in verbatim environments

\newcommand{\hideFromPandoc}[1]{#1}
\hideFromPandoc{ \let\Begin\begin \let\End\end }
\input{macrosCR}

% lncs 
\usepackage{makeidx}
\institute{University of Groningen, The Netherlands} 

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{€}
\fi
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}, formatcom=%
{\linespread{0.9}\normalfont\ttfamily\fontsize{9}{1}\selectfont}}

\newenvironment{Shaded}{}{}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\OutOfFocus}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Folkert de Vries & Jorge Pérez},
            pdftitle={Reversible Session-Based Concurrency in Haskell},
            colorlinks=true,
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{5}

% ================
% math stuff 

% ==============

%%%--- Instead of ru/rug style:
\setbeamersize{text margin left=1em,text margin right=1em}
%\usecolortheme{whale} %% blue
%\usecolortheme{crane} %% yellow
%\usecolortheme{wolverine} 
\usecolortheme{spruce} %% green
%\usecolortheme[RGB={204,0,0}]{structure}
%\usecolortheme{orchid}
\setbeamertemplate{navigation symbols}{}

\defbeamertemplate*{footline}{ru theme}{%
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.4\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \end{beamercolorbox}%
  %\begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
   % \usebeamerfont{author in head/foot}\insertshortdate
  %\end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.53\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\textcolor{white}{\insertshorttitle}
  \end{beamercolorbox}%
   \begin{beamercolorbox}[wd=0.07\paperwidth,ht=2.25ex,dp=1ex,right]{title in head/foot}%
     {\textcolor{white}{\insertframenumber{} / \inserttotalframenumber}}\hspace*{2ex} 
  \end{beamercolorbox}}%
  \vskip0pt%
}
%%%---



\mode<presentation>
{
  %\usetheme{Madrid}
  % or ...
  %\usetheme[fontPath=Fonts/, imagesPath=Images/, titleHeight=1.45cm]{IMT}


  %\setbeamercovered{transparent}
  % or whatever (possibly just delete it)
}

%\AtBeginSection[] { 
%\begin{frame}[plain] 
    %\frametitle{Roadmap} 
    %\tableofcontents[currentsection] 
%\end{frame} 
%\addtocounter{framenumber}{-1}
%} 

\title[\textcolor{white}{Reversible Session-Based Concurrency}]{Reversible Session-Based Concurrency}
\subtitle{An implementation in Haskell}
\author[F. de Vries]{Folkert de Vries \& Jorge Pérez} 
\date[November 22, 2018]
{
    PLNL 2018
\\
November 22, 2018
}

\usepackage[english]{babel}
%\usepackage{geometry}
%\geometry{paperwidth=\the\paperwidth,   paperheight=\the\paperheight,   hmargin=1cm,   vmargin=0cm,   head=0cm, headsep=0pt,foot=0cm}
\makeindex

\begin{document}

%\bluetrue
%\begin{firstframe}
%
%\hspace{2.5cm} A customized first frame.
%
%\vspace{4.6cm}
%
%\hspace{2.5cm} In the next frame there will be a standard one.
%\end{firstframe}

%\maketitle

\begin{frame}

\begin{center}
\maketitle
\end{center}

\end{frame}

\begin{frame}
\frametitle{Theoretical Background}
\begin{center}
\includegraphics[scale=1.0]{figmodel.pdf}
\end{center}
\end{frame}
    

\begin{frame}
\begin{center}
    \LARGE{Implementation} 
\end{center}
\end{frame}



\begin{frame}[fragile]
\frametitle{Implementation}
    Three core concepts $\rightarrow$ three data types:
    \begin{Shaded}
        \begin{Highlighting}[]
            \CommentTok{-- Our Process Calculus}
            \KeywordTok{data} \DataTypeTok{Program} \FunctionTok{=} \NormalTok{...} 
            \CommentTok{-- Our Global Session Type} 
            \KeywordTok{data} \DataTypeTok{GlobalType} \FunctionTok{=} \NormalTok{...} 
            \CommentTok{-- Our "bread crumbs"} 
            \KeywordTok{data} \DataTypeTok{TypeContext} \FunctionTok{=} \NormalTok{...} 
        \end{Highlighting}
    \end{Shaded}
    With the functions:
    \begin{Shaded}
        \begin{Highlighting}[]
            \KeywordTok{type} \DataTypeTok{Session} \NormalTok{a }\FunctionTok{=} \DataTypeTok{StateT} \DataTypeTok{ExecutionState} \NormalTok{(}\DataTypeTok{Except} \DataTypeTok{Error}\NormalTok{) a}
            \OtherTok{forward  ::} \DataTypeTok{Location} \OtherTok{->} \DataTypeTok{Session} \NormalTok{()}
            \OtherTok{backward ::} \DataTypeTok{Location} \OtherTok{->} \DataTypeTok{Session} \NormalTok{()}
        \end{Highlighting}
    \end{Shaded}

\end{frame}


\begin{frame}[fragile]
\frametitle{Implementation}
    The Program 

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{ProgramF}\NormalTok{ value next }
    \CommentTok{-- send/receive}
    \FunctionTok{=} \DataTypeTok{Send} 
\NormalTok{        \{}\OtherTok{ owner ::} \DataTypeTok{Participant}\NormalTok{,}\OtherTok{ value ::}\NormalTok{ value,}\OtherTok{ continuation ::}\NormalTok{ next \}}
    \FunctionTok{|} \DataTypeTok{Receive} 
\NormalTok{        \{}\OtherTok{ owner ::} \DataTypeTok{Participant}
\NormalTok{        ,}\OtherTok{ variableName ::} \DataTypeTok{Identifier}
\NormalTok{        ,}\OtherTok{ continuation ::}\NormalTok{ next  }
\NormalTok{        \}}

    \CommentTok{-- choice}
    \FunctionTok{|} \DataTypeTok{Offer} \DataTypeTok{Participant}\NormalTok{ (}\DataTypeTok{List}\NormalTok{ (}\DataTypeTok{String}\NormalTok{, next))}
    \FunctionTok{|} \DataTypeTok{Select} \DataTypeTok{Participant}\NormalTok{ (}\DataTypeTok{List}\NormalTok{ (}\DataTypeTok{String}\NormalTok{, value, next))}

    \CommentTok{-- other}
    \FunctionTok{|} \DataTypeTok{Parallel}\NormalTok{ next next }
    \FunctionTok{|} \DataTypeTok{Application} \DataTypeTok{Participant}\NormalTok{ value value}
    \FunctionTok{|} \DataTypeTok{NoOp}
\end{Highlighting}
\end{Shaded}
    We can use the \texttt{Free} monad for convenient DSLs.

\end{frame}








\begin{frame}[fragile]
\frametitle{Implementation}
    The Global Type 

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{GlobalTypeF}\NormalTok{ participant u f}
    \FunctionTok{=} \DataTypeTok{Transaction} 
\NormalTok{        \{}\OtherTok{ from ::}\NormalTok{ participant,}\OtherTok{ to ::}\NormalTok{ participant}
\NormalTok{        ,}\OtherTok{ tipe ::}\NormalTok{ u,}\OtherTok{ continuation ::}\NormalTok{  f }
\NormalTok{        \} }
    \FunctionTok{|} \DataTypeTok{Choice} 
\NormalTok{        \{}\OtherTok{ from ::}\NormalTok{ participant,}\OtherTok{ to ::}\NormalTok{ participant}
\NormalTok{        ,}\OtherTok{ options ::} \DataTypeTok{Map} \DataTypeTok{String}\NormalTok{ f }
\NormalTok{        \}}
    \FunctionTok{|} \DataTypeTok{R}\NormalTok{ f}
    \FunctionTok{|} \DataTypeTok{V}
    \FunctionTok{|} \DataTypeTok{Wk}\NormalTok{ f}
    \FunctionTok{|} \DataTypeTok{End}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{type} \DataTypeTok{GlobalType}\NormalTok{ participant u a }\FunctionTok{=} 
    \DataTypeTok{Free}\NormalTok{ (}\DataTypeTok{GlobalTypeF}\NormalTok{ participant u) a }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{type} \DataTypeTok{TerminatingGlobalType}\NormalTok{ participant u }\FunctionTok{=} 
    \DataTypeTok{Free}\NormalTok{ (}\DataTypeTok{GlobalTypeF}\NormalTok{ participant u) }\DataTypeTok{Void}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]
\frametitle{Implementation: Use of \texttt{Void}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{type} \DataTypeTok{TerminatingGlobalType}\NormalTok{ participant u }\FunctionTok{=} 
    \DataTypeTok{Free}\NormalTok{ (}\DataTypeTok{GlobalTypeF}\NormalTok{ participant u) }\DataTypeTok{Void}
\end{Highlighting}
\end{Shaded}

A value of type \texttt{Free f Void} doesn't contain \texttt{Pure} constructors.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{Free}\NormalTok{ f a }
    \FunctionTok{=} \DataTypeTok{Pure}\NormalTok{ a }
    \FunctionTok{|} \DataTypeTok{Free}\NormalTok{ (f (}\DataTypeTok{Free}\NormalTok{ f a))}
\end{Highlighting}
\end{Shaded}

Ensures* that we've terminated our program/type. 

\end{frame}


\begin{frame}[fragile]
\frametitle{Implementation: Type-level reversibility}
    The "Breadcrumbs"

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{TypeContextF}\NormalTok{ a previous }
    \FunctionTok{=} \DataTypeTok{Transaction}\NormalTok{ (}\DataTypeTok{LocalType.Transaction}\NormalTok{ a previous)}
    \FunctionTok{|} \DataTypeTok{ISelected} 
\NormalTok{        \{}\OtherTok{ owner ::} \DataTypeTok{Participant}
\NormalTok{        ,}\OtherTok{ offerer ::} \DataTypeTok{Participant} 
\NormalTok{        ,}\OtherTok{ selection ::} \DataTypeTok{Zipper}\NormalTok{ (}\DataTypeTok{String}\NormalTok{, }\DataTypeTok{LocalType}\NormalTok{ a)}
\NormalTok{        ,}\OtherTok{ continuation ::}\NormalTok{ previous }
\NormalTok{        \}}
    \FunctionTok{|} \FunctionTok{...}

\KeywordTok{type} \DataTypeTok{Zipper}\NormalTok{ a }\FunctionTok{=} 
\NormalTok{    ([a], a, [a])}
\end{Highlighting}
\end{Shaded}

\end{frame}


\begin{frame}[fragile]
\frametitle{Implementation: Value-level reversibility}

We must remember variable names:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{vendor ::} \DataTypeTok{HighLevelProgram}\NormalTok{ a}
\NormalTok{vendor }\FunctionTok{=} \KeywordTok{do}
\NormalTok{    t }\OtherTok{<-}\NormalTok{ H.receive}
\NormalTok{    H.send (price t) }
\NormalTok{    H.send (price t) }
    \FunctionTok{...}
\NormalTok{    terminate}
\end{Highlighting}
\end{Shaded}

Subsequent instructions (the sends) depend on the name $t$.
When evaluating and then reverting, we have to put the same name into the AST.

\end{frame}



\begin{frame}[fragile]
\frametitle{Implementation: Value-level reversibility}

We must remember function calls and their arguments:

\end{frame}

\begin{frame}[fragile]
\frametitle{Implementation: Value-level reversibility}

We must remember unselected branches:


\end{frame}


\begin{frame}[fragile]
\frametitle{Implementation: Value-level reversibility}

We must remember messages on the channel:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{alice ::} \DataTypeTok{HighLevelProgram}\NormalTok{ a}
\NormalTok{alice }\FunctionTok{=} \KeywordTok{do}
\NormalTok{    H.send (}\DataTypeTok{VString} \StringTok{"Logicomix"}\NormalTok{ )}
    \FunctionTok{...}

\OtherTok{vendor ::} \DataTypeTok{HighLevelProgram}\NormalTok{ a}
\NormalTok{vendor }\FunctionTok{=} \KeywordTok{do}
\NormalTok{    t }\OtherTok{<-}\NormalTok{ H.receive}
    \FunctionTok{...}
\end{Highlighting}
\end{Shaded}

\end{frame}

\begin{frame}[fragile]
\frametitle{Advantages of a pure functional language}


\begin{itemize}
    \item Algebraic Data Types (Union Types) 
        \begin{itemize}
            \item         We can stay close to the theory 
            \item         invalid states are impossible to represent
        \end{itemize} \footnotesize
\begin{align*}
    G, G'  \bnfis & \gtcom{p}{q}{U}{G} %\bnfbar 
    \sbnfbar
    \gtcho{p}{q}{\lbl_i}{G_i} %\\
    \sbnfbar %& 
    \mu X. G \sbnfbar X \sbnfbar \gend 
\end{align*}
\normalsize

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{GlobalTypeF}\NormalTok{ u next }\FunctionTok{=} 
    \DataTypeTok{Transaction}\NormalTok{ \{}\FunctionTok{..}\NormalTok{\} }\FunctionTok{|} \DataTypeTok{Choice}\NormalTok{ \{}\FunctionTok{..}\NormalTok{\}  }\FunctionTok{|} \DataTypeTok{R}\NormalTok{ next }\FunctionTok{|} \DataTypeTok{V} \FunctionTok{|} \DataTypeTok{End} \FunctionTok{|} \DataTypeTok{Wk}\NormalTok{ next}
\end{Highlighting}
\end{Shaded}


        \vspace*{0.2cm}
    \item Immutability \& checked effects  
        \begin{itemize}
            \item Reversibility is easier and testable 
        \end{itemize}

\end{itemize}

\end{frame}


\begin{frame}[fragile]
\frametitle{Conclusion}

An implementation of reversible, session-based concurrency in Haskell
\begin{itemize}
    \item Embedding a sophisticated operational semantics in Haskell
    \item The first functional implementation of a reversible debugger
    \item \url{https://github.com/folkertdev/reversible-debugger/}
\end{itemize}

\smallskip

Current and future work:
\begin{itemize}
    \item Graphical interfaces
    \item Controlled reversibility (checkpoints)
\end{itemize}

\end{frame}

\begin{frame}[t]
\frametitle{Questions}
\begin{center}
\includegraphics[scale=0.06]{img/gothenburg-cruise.JPG}
\end{center}
\end{frame}
    


\end{document}
